智能视频监控系统接口文档

## 1 规范说明

### 1.1 通信协议

HTTP/HTTPS协议

### 1.2 请求方法

目前请求支持GET/POST方法请求

### 1.3 字符编码

HTTP通讯及报文

均采用UTF-8字符集编码格式。

### 1.4 格式说明

元素出现要求说明：

| 符号 | 说明                             |
| ---- | :------------------------------- |
| Y    | 报文中该元素必须出现（Required） |
| N    | 报文中该元素可选出现（Optional） |

### 1.5 请求报文结构

#### 1.5.1 获取视频源

URL: ``` /index/api/getMediaList```

功能：获取流列表，可选筛选参数

范例：```http://www.fourhu.xyz:9080/index/api/getMediaList?secret=035c73f7-bb6b-4889-a715-d9eb2d1925cc&schema=rtmp```

#### 1.5.1.1 请求

参数说明:

| 参数 | 是否必选                             |释意|
| ---- | :------------------------------- | ---- |
| secret    | Y |api操作密钥(配置文件配置)，如果操作ip是127.0.0.1，则不需要此参数|
| schema    | Y |筛选协议，例如 只支持rtmp|
|vhost	|N	|筛选虚拟主机，例如__defaultVost__|
|app	|N	|筛选应用名，例如 live|
|addr	|N	|服务端地址|

#### 1.5.1.2 应答
应答参数说明，应答参数为json格式:
HTTP返回200时,body格式为:

```json
{
    "code": 0,
    "data": [
        {
            "app": "normal",
            "schema": "rtmp",
            "stream": "classroom01-camera01",
            "vhost": "www.fourhu.xyz",
            "addr": "193.112.253.67:9080"
        },
        {
            "app": "normal",
            "schema": "rtmp",
            "stream": "classroom01-camera02",
            "vhost": "www.fourhu.xyz",
            "addr": "193.112.253.67:9080"
        },
        {
            "app": "normal",
            "schema": "rtmp",
            "stream": "classroom01-camera03",
            "vhost": "__defaultVhost__",
            "addr": "192.168.31.193:80"
        }
    ],
    "msg": "success"
}
```

code为0时,表示正常; code非0异常,异常返回示例:
```json
{
    "code": -300,
    "msg": "schema is only support rtmp"
}
```

| 参数 | 是否必选                             |释意|
| ---- | :------------------------------- | -------------------------------- |
| app | Y |筛选应用名，例如 live|
| schema | Y |筛选协议，例如 只支持rtmp|
|vhost	|Y	|筛选虚拟主机，例如__defaultVost__|
|stream	|Y	|流id，例如 livestream|

#### 1.5.2 获取视频文件

URL: ``` /index/api/getMediaFile```

功能：获取录像文件

请求方式: HTTP/GET

范例：```http://www.fourhu.xyz:9080/index/api/getMediaFile?date=2019-11-30```

#### 1.5.1.1 请求

参数说明:

| 参数         | 是否必选 | 释意                                                         |
| ------------ | :------- | ------------------------------------------------------------ |
| pageIdx      | Y        | 分页页数                                                     |
| pageSize     | Y        | 每页数据条数                                                 |
| startTime    | N        | 开始时间，格式:YYYY-MM-dd                                    |
| endTime      | N        | 结束时间，格式:YYYY-MM-dd                                    |
| stream       | N        | 流ID                                                         |
| monitorsType | N        | 视频类型, new-normal: 普通视频; new-violation-rule: 考室违规视频;new-violation-rule-desktop: 考生桌面违规视频 |

#### 1.5.1.2 应答

应答参数说明，应答参数为json格式:
HTTP返回200时,成功;否则为失败;
成功时body格式为:

```json
[
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/00-08-39.mp4",
        "name":"教室一-摄像头一-2020-01-17 00-08-39.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/01-08-41.mp4",
        "name":"教室一-摄像头一-2020-01-17 01-08-41.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/02-08-42.mp4",
        "name":"教室一-摄像头一-2020-01-17 02-08-42.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/03-08-44.mp4",
        "name":"教室一-摄像头一-2020-01-17 03-08-44.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/04-08-45.mp4",
        "name":"教室一-摄像头一-2020-01-17 04-08-45.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/05-08-47.mp4",
        "name":"教室一-摄像头一-2020-01-17 05-08-47.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/06-08-48.mp4",
        "name":"教室一-摄像头一-2020-01-17 06-08-48.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/07-08-50.mp4",
        "name":"教室一-摄像头一-2020-01-17 07-08-50.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-17/08-08-51.mp4",
        "name":"教室一-摄像头一-2020-01-17 08-08-51.mp4"
    },
    {
        "url":"http://192.168.1.250:9081/new-violation-rule-desktop/record/normal/classroom01-camera01/classroom01-camera01/2020-01-16/21-08-34.mp4",
        "name":"教室一-摄像头一-2020-01-16 21-08-34.mp4"
    }
]
```


body参数

| 参数 | 是否必选 | 释意                      |
| ---- | :------- | ------------------------- |
| name | Y        | josn obj     |
| url | Y        | 筛选协议，例如 只支持rtmp |